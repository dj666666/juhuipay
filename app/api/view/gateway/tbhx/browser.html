<!DOCTYPE html>
<!-- saved from url=(0042)https://p.6ffk7p.z1024.top/zfb/pc/29330620 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta http-equiv="Content-Language" content="zh-cn">
  <meta name="apple-mobile-web-app-capable" content="no">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="format-detection" content="telephone=no,email=no">
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>在线支付 - 支付宝 - 网上支付 安全快速</title>
  <link href="/assets/css/dfpay/dfpay.css" rel="stylesheet" media="screen">
  <link rel="stylesheet" href="/assets/static/layui/css/layui.css">
  <link rel="stylesheet" href="/assets/libs/bootstrap/dist/css/bootstrap.min.css">
  <script src="/assets/static/js/jquery3.3.1.js"></script>
  <script src="/assets/css/dfpay/qrcode.min.js"></script>
  <script src="/assets/static/layui/layui.js" type="text/javascript"></script>
  <!--<script src="/assets/static/js/clipboard.min.js" type="text/javascript"></script>-->
  <script src="/assets/js/clipboard.min.js"></script>
  <script src="/assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>

</head>
<body>
<div class="body">
  <!--<h1 class="mod-title">
    
    <img src="/assets/img/alipay_logo.png" alt="">
  </h1>-->

  <h1 align="center" style="color: #1e9eff;font-size:20px;padding-top:5px;">请按照下列步骤充值</h1>
  <div class="mod-ct" style="border: 0px;">


    <div class="list-group" style="text-align: left;">
      <ul class="list-group">
        <li class="list-group-item list-group-item-success"><b>1.请使用淘宝或支付宝APP付款，若未下载APP请自行下载</b></li>
        <li class="list-group-item list-group-item-info"><b>2.购买之后，在订单详情复制凭证，到本页面提交，即可到账</b></li>
        <li class="list-group-item list-group-item-warning"><b>3.提交十位数短信凭证或淘宝订单详情电子凭证</b></li>
        <li class="list-group-item list-group-item-danger"><b>4.凭证码是10位！！！请勿复制单号，无需确认收货自动到账！</b></li>
      </ul>
    </div>
    <!--<div class="list-group" >

        <a href="#" class="list-group-item list-group-item-success">1.请填写您的支付宝账号，点击提交</a>
        <a href="#" class="list-group-item list-group-item-info">2.提交完后查看支付宝消息中的收款通知</a>
        <a href="#" class="list-group-item list-group-item-warning">3.看到收款通知后，确认金额和口令是否一致</a>
        <a href="#" class="list-group-item list-group-item-danger">4.点击进入付款即完成本次充值</a>
    </div>-->


    <div style="font-size: 18px;color:#f63435">
      <b>金额：{$amount}</b>
    </div>

    <!--<div class="time-item-alipay" >
        <strong id="hour_show" style="background: #1b76fb;"><s id="h"></s>00时</strong>
        <strong id="minute_show" style="background: #1b76fb;"><s></s>00分</strong>
        <strong id="second_show" style="background: #1b76fb;"><s></s>00秒</strong>
    </div>-->

    <div class="tip">
      <!--<a id="btnDL" href="javascript:;" onclick="gopay()" class="btn btn-primary">请点击立即支付</a>-->
      <!--<button type="button" id="paybtn" onclick="gopay()" class="btn btn-success btn-lg btn-block" style="width:100%;background-color:#2ebfff;color:white;font-size:18px">点击启动支付宝支付</button>-->
        <!--<a id='paybtn' href="{$click_data}" target="_blank" style="color: #fff;text-decoration: none; text-align: center;padding: .55rem 0; display: inline-block; width: 90%; border-radius: .5rem; font-size: 18px;background-color: #2ccb3d; border: 1px solid #2ccb3d;letter-spacing:normal;font-weight: normal"
         class='action'>打开淘宝APP购买</a>-->
        
        <a id='paybtn' href="javascript:;" onclick="gopayzfb()" style="color: #fff;text-decoration: none; text-align: center;padding: .55rem 0; display: inline-block; width: 90%; border-radius: .5rem; font-size: 18px;background-color: #1b76fb; border: 1px solid #1b76fb;letter-spacing:normal;font-weight: normal"
         class='action'>打开支付宝APP购买</a>
         
         <a id='paybtn' href="javascript:;" onclick="gopay()" style="margin-top:20px;color: #fff;text-decoration: none; text-align: center;padding: .55rem 0; display: inline-block; width: 90%; border-radius: .5rem; font-size: 18px;background-color: #fe6f2c; border: 1px solid #fe6f2c;letter-spacing:normal;font-weight: normal"
         class='action'>打开淘宝APP购买</a>
    </div>


    <form class="form-inline">
        
        <div class="form-group" style="margin-top: 10px;">
            
        <input type="string" class="form-control" id="zfbacount" placeholder="请在此处填写淘宝订单详情凭证码" name="zfbacount" style="display: inline-block;width: 90%;">
          
        </div>
        <button type="button" id="subAcount" class="btn btn-lg btn-block" style="background-color: #2ccb3d;color: #fff;width: 90%;display: inline-block; ">提交</button>
    </form> 

    <!--<a id='subAcount' href="javascript:;" style="margin-top:10px;color: #fff;text-decoration: none; text-align: center;padding: .55rem 0; display: inline-block; width: 80%; border-radius: .5rem; font-size: 18px;background-color: #1b76fb; border: 1px solid #1b76fb;letter-spacing:normal;font-weight: normal" class='action'>确定提交</a>-->
    
    <div class="time-item" style="margin-top:20px;">
        <p style="color: red;">凭证码复制示例如下</p>
        <img  id='show_qrcode' alt="加载中..." src="/assets/img/tbhx.png" width="330" height="500" style="display: inline-block;">
    </div>


  </div>


</div>
<div class="copyRight">

</div>
<!--注意下面加载顺序 顺序错乱会影响业务-->
<script>
  layui.use(['layer','form'], function(){
    var $ = layui.jquery, layer = layui.layer, form = layui.form;

    layer.confirm('购买后记得回来本页面提交凭证码才能充值成功，凭证码是10位数的哦', {
      title: "支付提示",
      icon: 1,
      btn: ['我已知晓'],
      closeBtn :0,
      btnAlign: "c",
    }, function(index, layero){

      layer.close(index);

    });



    /*layer.prompt({
        btn:['确定提交'],
        closeBtn :0,
        title: '请输入你付款账号的名字',
        formType: 0

    }, function (value, index) {

        $.post("/api/gateway/setName", {
            tradeNo: orderNo,
            name:value
        },
        function(data){
            console.log(data);
            if(data.code==1){
                layer.close(index);
                layer.msg(data.msg, {time: 2000}, function () {

                });


            }else{
                layer.msg(data.msg, {time: 1500, anim: 6});
            }
        });



    });*/

  })

  //二维码对象
  var objQrCode;
  //检查订单定时器
  var checkOrderInterval;
  //倒计时定时器
  var countDownInterval;
  //支付地址
  var payUrl = '<?php echo $payurl ;?>';
  //订单编号
  var orderNo = '<?php echo $out_trade_no ;?>';
  var orderId = '29330620';
  var time    = '<?php echo $time ;?>';
  var click_data    = '<?php echo $click_data ;?>';



  //设置二维码超时
  var setQrCodeTimeOut = function (message) { //二维码超时则停止显示二维码
    /*$(".qrcode-img-area .expired").removeClass("hidden");
    $(".btn-pay").removeClass("btn-alipay");
    $(".btn-pay").addClass("btn-expired");
    $(".btn-pay")[0].innerHTML = '111';
    $(".btn-pay")[0].disabled = true;*/

    $('#hour_show').html('<s id="h"></s>' + '00' + '时');
    $('#minute_show').html('<s></s>' + '00' + '分');
    $('#second_show').html('<s></s>' + '00' + '秒');
    $("#expiredDiv").attr("style","display:block;");
    $("#paybtn").hide();

    clearInterval(checkOrderInterval);
    clearInterval(countDownInterval);
  }

  //定时检测订单支付情况
  var countDown = function (intDiff) {
    countDownInterval = window.setInterval(function () {
      var day = 0,
              hour = 0,
              minute = 0,
              second = 0;//时间默认值
      if (intDiff > 0) {
        day = Math.floor(intDiff / (60 * 60 * 24));
        hour = Math.floor(intDiff / (60 * 60)) - (day * 24);
        minute = Math.floor(intDiff / 60) - (day * 24 * 60) - (hour * 60);
        second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
      }

      if (hour <= 9)
        hour = '0' + hour;
      if (minute <= 9)
        minute = '0' + minute;
      if (second <= 9)
        second = '0' + second;
      $('#hour_show').html('<s id="h"></s>' + hour + '时');
      $('#minute_show').html('<s></s>' + minute + '分');
      $('#second_show').html('<s></s>' + second + '秒');
      if (hour <= 0 && minute <= 0 && second <= 0) {
        setQrCodeTimeOut("订单已过期，请重新提交订单")
      }
      intDiff--;
    }, 1000);
  }

  var checkOrder = function () {
    $.get("/api/gateway/checkorder", { tradeNo: orderNo, t: Math.random() }, function (result) {
      if (result.data.status == "1") {
        setQrCodeTimeOut("支付成功");
        layer.alert("支付成功", {icon: 1,closeBtn: 0},function(index){
          //closeWindow();
          layer.close(index)

          location.reload();

        });

      }else if (result.data.status == "3") {

        layer.alert("支付时间已过期", {icon: 2,closeBtn: 0},function(index){
          //closeWindow();
          layer.close(index)
          //location.reload();
        });

        setQrCodeTimeOut("订单超时");
      }
    });
  }

  $(document).ready(function () {

    //$(".qrcode-img-area .expired").addClass("visible");


    //打开订单信息
    //$('#orderDetail .detail-ct').slideDown(500, function () {
    //    $('#orderDetail').addClass('detail-open');
    //});

    //生成二维码
    /*objQrCode = new QRCode('show_qrcode', {
        render: "canvas",
        text: payUrl,
        width: 210,
        height: 210,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.L
    });*/
    //var margin = ($("#show_qrcode").height() - $("#imgLogo").height()) / 2; //控制Logo图标的位置
    //$("#imgLogo").css("margin", margin);


    $('#orderDetail .arrow').click(function (event) {
      if ($('#orderDetail').hasClass('detail-open')) {
        $('#orderDetail .detail-ct').slideUp(500, function () {
          $('#orderDetail').removeClass('detail-open');
        });
      } else {
        $('#orderDetail .detail-ct').slideDown(500, function () {
          $('#orderDetail').addClass('detail-open');
        });
      }
    });

    //检查订单
    checkOrderInterval = setInterval(checkOrder, 1000);

    //执行倒计时
    countDown(time);
    
    
    
  });


  //点击跳转
  function gopay(){
      
    const id = click_data.match(/id=(\d+)/)[1];
    var url = 'taobao://item.taobao.com/item.htm?id='+id;

    window.location.href=url;
  }
  
  //点击跳转
  function gopayzfb(){
      
    window.location.href='alipays://platformapi/startapp?appId=20000067&url=' + encodeURIComponent(click_data);
  }

  //复制金额
  $('#copybtn').click(function(){
    var copy1 = new copyFunc('copybtn');
  })


  function copyFunc(id){
    var clip = new ClipboardJS('#' + id);

    clip.on('success', function (e) {
      console.log(33);
      layer.msg('复制成功!', {time : 1000});
      console.log(e);
      //打印动作信息（copy或者cut）
      console.info('Action:', e.action);
      //打印复制的文本
      console.info('Text:', e.text);
      //打印trigger
      console.info('Trigger:', e.trigger);
    });

    clip.on('error', function (e) {
      console.log(44);
      layer.msg('复制失败!', {time : 1500, anim: 6});
    });
  }

  $("#subAcount").click(function () {

    var zfbcode = $("#zfbacount").val();
    zfbcode = zfbcode.trim();

    if(zfbcode == null || zfbcode == ""){
      layer.msg('请填写您的核销码', {time: 1500, anim: 6});
      return;
    }

    $.post("/api/gateway/subTbCode","tradeNo="+orderNo+"&code="+zfbcode,function (data) {

      if (data.code == 1) {
        //toastr.success(data.msg);
        layer.msg(data.msg, {icon:16, time : 20000});
      }else{
        layer.msg(data.msg, {icon:2, time: 1500, anim: 6});
      }

    })


  })


</script>

</body></html>