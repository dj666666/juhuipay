<!DOCTYPE html>
<!-- saved from url=(0042)https://p.6ffk7p.z1024.top/zfb/pc/29330620 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="Content-Language" content="zh-cn">
    <meta name="apple-mobile-web-app-capable" content="no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no,email=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="white">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>数字钱包支付</title>
    <link href="/assets/css/dfpay/dfpay.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="/assets/static/layui/css/layui.css">
    <script src="/assets/static/js/jquery3.3.1.js"></script>
    <script src="/assets/css/dfpay/qrcode.min.js"></script>
    <script src="/assets/static/layui/layui.js" type="text/javascript"></script>
    <!--<script src="/assets/static/js/clipboard.min.js" type="text/javascript"></script>-->
    <script src="/assets/js/clipboard.min.js"></script>
    <!--<link type="text/css" rel="stylesheet" href="/assets/static/szqb/css.css">-->
    
    <style>
        .bank_info{
        	width: 80%;
        	height: 100px;
        	margin-top: 10px;
        	margin-left: 2.5rem;
        	padding: 10px 10px 10px 10px;
        	border: 3px solid #f00;
        	border-radius: 10px;
        	line-height: 30px;
        	list-style-type: none;
        	text-align:left;
        }
        .bank_info li{
            font-weight: bold;
        }
        /*.bank_info .txtlable{
            float: left;
            
            
        }*/
        .bank_info .copy_btn{
            float: right;
            color: #0068d2;
            font-weight: normal;
            /*text-decoration: underline;*/
        }
        #downbtn {
            display: block;
        	width: 5rem;
        	height: 0.6rem;
        	line-height: 0.6rem;
        	border-radius:0.4rem;
        	background:#f83d38;
        	margin:0 auto;
        	color:#fff;
        	font-size:0.3rem;
        	position: relative;
        	box-shadow:0.02rem 0.02rem 0.02rem rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div class="body">
        <h1 class="mod-title" style="font-size:20px;color: #f00">
            
            <b>RMB数字钱包支付</b>
            
        </h1>
        <div class="mod-ct">
            <div class="order">
            </div>
            <div class="amount" style="color:#000;">￥
                <span id="money">{$pay_amount}</span>
            
                <button type="button" id="copybtn" class="btn btn-info btn-sm copy2" style="background-color:rgb(246,52,53) !important;border:none;color:#fff;" data-clipboard-target="#money">复制</button>
            
            </div>
			<div class="time-item" id="msg">
			    <h1 >请复制金额,按照以下钱包编号,完成转账</h1>
			    <p style="color: red;"><b>请勿重复付款！不到账联系客服！</b></p>
			</div>
            <div >
                <ul class="bank_info" style="">
				<li>
					<span>收款户名：<em id="copy2"><u style="text-decoration: none;"><font color="blue" id="bank_user">{$payurl}</font></u></em></span>
					<span class="copy_btn copy_btn2" id="copybank_user" data-clipboard-target="#bank_user" >复制</span>
				</li>
				<li>
					<span class="txtlable">钱包编号：<em id="copy3"><u style="text-decoration: none;"><font color="blue" id="bank_number">{$remark}</font></u></em></span>
					<span class="copy_btn copy_btn3" id="copybank_number" data-clipboard-target="#bank_number">复制</span>
				</li>
				<li>
					<span class="txtlable">转帐金额：<em id="copy4"><u style="text-decoration: none;"><font color="red" id="amount">{$pay_amount}</font></u></em></span>
					<span class="copy_btn copy_btn4" id="copyamount" data-clipboard-target="#amount">复制</span>
				</li>
			</ul>
            </div>
            <div class="time-item-alipay" >
                <!--<strong id="hour_show" style="background: #1b76fb;"><s id="h"></s>00时</strong>-->
                <strong id="minute_show" style="background: #f00;"><s></s>00分</strong>
                <strong id="second_show" style="background: #f00;"><s></s>00秒</strong>
            </div>

            <div class="tip">
                
                <a id='downbtn' href="javascript:;" onclick="downszqb()"  style="margin-top:10px;color: #fff;text-decoration: none; text-align: center;padding: .55rem 0; display: inline-block; width: 80%; height:25px; border-radius: 15px; font-size: 17px;background-color: #f00; border: 1px solid #f00;letter-spacing:normal;font-weight: normal;line-height:25px;" class='action'>未安装数字人民币APP点此下载</a>
                
                <a id='paybtn' href="javascript:;" onclick="gopay()" style="margin-top:10px;color: #fff;text-decoration: none; text-align: center;padding: .55rem 0; display: inline-block; width: 80%; border-radius: 15px; font-size: 21px;background-color: #f00; border: 1px solid #f00;letter-spacing:normal;font-weight: normal;line-height:25px;" class='action'>已安装APP点此拉起转账</a>
                
                <dd style="color: red;">*如遇无法自动输入钱包编号请返回该页手动复制</dd>
                
            </div>
            
            <div class="time-item" style="width: 200px;height: 40px;line-height: 40px;background:#00a9ea;font-size:25px;border-radius:0 22px 22px 0;color:#fff;text-indent:22px;">
                转账教程
            </div>
            
            <div class="time-item" style="margin-top:20px; ">
                <img  id='show_qrcode' alt="加载中..." src="/assets/img/Gif_szqb.gif" width="330" height="700" style="display: inline-block;">
            </div>
            
            <div class="detail detail-ct detail-open" id="orderDetail">
                <dl class="detail-ct" id="desc" style="overflow: hidden; display: block;">
                    <dt>金额：</dt>
                    <dd>{$pay_amount}</dd>
                    <dt>订单：</dt>
                    <dd>{$out_trade_no}</dd>
                    <dt>创建时间：</dt>
                    <dd>{$create_time}</dd>
                    <dt></dt>
                    <dd id="orderStatus"></dd>
                </dl>

                <a href="javascript:void(0)" class="arrow"><i class="ico-arrow-alipay"></i></a>
            </div>
            
        </div>
        

    </div>
    <div class="copyRight">

    </div>
    <!--注意下面加载顺序 顺序错乱会影响业务-->
    <script>
        layui.use(['layer','form'], function(){
             var $ = layui.jquery, layer = layui.layer, form = layui.form;
             
           
            var copy1 = new copyFunc('copyamount')
            var copy2 = new copyFunc('copybank_user')
            var copy3 = new copyFunc('copybank_number')
            var copy4 = new copyFunc('copybank_type')
            
            function copyFunc(id){
                var clip = new ClipboardJS('#' + id);
                
                clip.on('success', function (e) {
                    layer.msg('复制成功!', {time : 1000});
                    console.log(e);
                    //打印动作信息（copy或者cut）
                    console.info('Action:', e.action);
                    //打印复制的文本
                    console.info('Text:', e.text);
                    //打印trigger
                    console.info('Trigger:', e.trigger);
                });
            
                clip.on('error', function (e) {
                    layer.msg('复制失败!', {time : 1500, anim: 6});
                });
            }
            
            /*layer.confirm('请复制金额粘贴到付款界面完成付款，严格按照提示金额付款，否则损失自行承担，切记切记！', {
                title: "支付提示",
                icon: 0,
                btn: ['复制金额'],
                closeBtn :0,
                btnAlign: "c",
            }, function(index, layero){
                console.log(11);
                //复制金额
                var copy1 = new copyFunc('money');
                
                $('#copybtn').click();
                layer.close(index);
                
            });*/
            
            
            
            layer.prompt({
                btn:['确定提交'],
                closeBtn :0,
                title: '请输入你付款账号的真实名字',
                formType: 0
                
            }, function (value, index) {
                
                $.post("/api/gateway/setName", {
                    tradeNo: orderNo,
                    name:value
                },
                function(data){
                    console.log(data);
                    if(data.code==1){
                        layer.close(index);
                        layer.msg(data.msg, {time: 2000}, function () {
                            
                        });
                        
                        
                    }else{
                        layer.msg(data.msg, {time: 1500, anim: 6});
                    }
                });
                
            });
        
        })
        
        //二维码对象
        var objQrCode;
        //检查订单定时器
        var checkOrderInterval;
        //倒计时定时器
        var countDownInterval;
        //支付地址
        var payUrl = '<?php echo $payurl ;?>';
        //订单编号
        var orderNo = '<?php echo $out_trade_no ;?>';
		var orderId = '29330620';
		var time    = '<?php echo $time ;?>';
		var click_data    = '<?php echo $click_data ;?>';

        
            
        //设置二维码超时
        var setQrCodeTimeOut = function (message) { //二维码超时则停止显示二维码
            /*$(".qrcode-img-area .expired").removeClass("hidden");
            $(".btn-pay").removeClass("btn-alipay");
            $(".btn-pay").addClass("btn-expired");
            $(".btn-pay")[0].innerHTML = '111';
            $(".btn-pay")[0].disabled = true;*/

            $('#hour_show').html('<s id="h"></s>' + '00' + '时');
            $('#minute_show').html('<s></s>' + '00' + '分');
            $('#second_show').html('<s></s>' + '00' + '秒');
            $("#expiredDiv").attr("style","display:block;");
            $("#paybtn").hide();
            $("#downbtn").hide();
            
            clearInterval(checkOrderInterval);
            clearInterval(countDownInterval);
        }

        //定时检测订单支付情况
        var countDown = function (intDiff) {
            countDownInterval = window.setInterval(function () {
                var day = 0,
                    hour = 0,
                    minute = 0,
                    second = 0;//时间默认值
                if (intDiff > 0) {
                    day = Math.floor(intDiff / (60 * 60 * 24));
                    hour = Math.floor(intDiff / (60 * 60)) - (day * 24);
                    minute = Math.floor(intDiff / 60) - (day * 24 * 60) - (hour * 60);
                    second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
                }

                if (hour <= 9)
                    hour = '0' + hour;
                if (minute <= 9)
                    minute = '0' + minute;
                if (second <= 9)
                    second = '0' + second;
                $('#hour_show').html('<s id="h"></s>' + hour + '时');
                $('#minute_show').html('<s></s>' + minute + '分');
                $('#second_show').html('<s></s>' + second + '秒');
                if (hour <= 0 && minute <= 0 && second <= 0) {
                    setQrCodeTimeOut("订单已过期，请重新提交订单")
                }
                intDiff--;
            }, 1000);
        }

        var checkOrder = function () {
            $.get("/api/gateway/checkorder", { tradeNo: orderNo, t: Math.random() }, function (result) {
                if (result.data.status == "1") {
                    
                    layer.alert("支付成功", {icon: 1,closeBtn: 0},function(index){
                        //closeWindow();
                        layer.close(index)
                        
                        location.reload();
                    });
                    
                }else if (result.data.status == "3") {
                    
                    layer.alert("支付时间已过期", {icon: 2,closeBtn: 0},function(index){
                        //closeWindow();
                        layer.close(index)
                        location.reload();
                    });
                    
                    setQrCodeTimeOut("订单超时");
                }
            });
        }

        $(document).ready(function () {
            
            //$(".qrcode-img-area .expired").addClass("visible");
            
            
			//打开订单信息
            //$('#orderDetail .detail-ct').slideDown(500, function () {
            //    $('#orderDetail').addClass('detail-open');
            //});
			
            //生成二维码
            /*objQrCode = new QRCode('show_qrcode', {
                render: "canvas",
                text: payUrl,
                width: 210,
                height: 210,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.L
            });*/
            //var margin = ($("#show_qrcode").height() - $("#imgLogo").height()) / 2; //控制Logo图标的位置
            //$("#imgLogo").css("margin", margin);


            $('#orderDetail .arrow').click(function (event) {
                if ($('#orderDetail').hasClass('detail-open')) {
                    $('#orderDetail .detail-ct').slideUp(500, function () {
                        $('#orderDetail').removeClass('detail-open');
                    });
                } else {
                    $('#orderDetail .detail-ct').slideDown(500, function () {
                        $('#orderDetail').addClass('detail-open');
                    });
                }
            });
            
            //检查订单
            checkOrderInterval = setInterval(checkOrder, 1000);
            
            //执行倒计时
            countDown(time);
        });
        
        
        //点击跳转
        function gopay(){
            
            //var url = 'dcep://uniwallet/startApp/commonLink?uniwallet_biz=redPacket&uniwallet_version=1.0&uniwallet_pathType=PT01';;
            var url = 'dcep://uniwallet/startApp/commonLink?uniwallet_biz=redPacket&uniwallet_version=1.0&uniwallet_pathType=PT01';;
            
            window.location.href = url;
        }
        
        //点击下载
        function downszqb(){
            
            var url = 'https://pilot.app.ecny.pbcdci.cn/download/index.html';;
            
            window.location.href = url;
        }
        
        
        //复制金额
        $('#copybtn').click(function(){
            var copy1 = new copyFunc('copybtn');
        })
        
        
        function copyFunc(id){
            var clip = new ClipboardJS('#' + id);
            
            clip.on('success', function (e) {
                console.log(33);
                layer.msg('复制成功!', {time : 1000});
                console.log(e);
                //打印动作信息（copy或者cut）
                console.info('Action:', e.action);
                //打印复制的文本
                console.info('Text:', e.text);
                //打印trigger
                console.info('Trigger:', e.trigger);
            });
        
            clip.on('error', function (e) {
                console.log(44);
                layer.msg('复制失败!', {time : 1500, anim: 6});
            });
        }
        
    </script>

</body></html>